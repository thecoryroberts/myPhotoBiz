@model MyPhotoBiz.ViewModels.UserClientDetailsViewModel
@{
    ViewBag.Title = Model.User.FullName;
    ViewBag.PageTitle = "User Details";
    ViewBag.SubTitle = "Users";
    ViewBag.SubTitleUrl = Url.Action("Index", "Users");
    ViewBag.Icon = "ti-user";
    ViewBag.Color = "primary";

    var avatarUrl = Model.User.ProfilePicture;
    var initials = MyPhotoBiz.Helpers.ViewHelper.GetInitials(Model.User.FirstName, Model.User.LastName);

    var statusBadge = Model.User.Status switch
    {
        "Active" => "bg-success-subtle text-success",
        "Inactive" => "bg-secondary-subtle text-secondary",
        "Locked" => "bg-danger-subtle text-danger",
        "Pending" => "bg-warning-subtle text-warning",
        _ => "bg-secondary-subtle text-secondary"
    };
    var statusIcon = Model.User.Status switch
    {
        "Active" => "ti-check",
        "Inactive" => "ti-minus",
        "Locked" => "ti-lock",
        "Pending" => "ti-clock",
        _ => "ti-help"
    };
    var statsColClass = Model.Client != null ? "col-md-3" : "col-md-4";
}

<div class="container-fluid">
    <partial name="Partials/_PageTitle" />

    <div class="row">
        <div class="col-12">
            <article class="card card-out-of-container border-top-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div class="d-flex justify-content-start align-items-center gap-3">
                            <div class="avatar avatar-xxl">
                                @if (!string.IsNullOrEmpty(avatarUrl))
                                {
                                    <img src="@Url.Content(avatarUrl)" alt="Profile" class="img-fluid img-thumbnail rounded-circle">
                                }
                                else
                                {
                                    <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-1">
                                        @initials
                                    </span>
                                }
                            </div>
                            <div>
                                <h4 class="text-nowrap fw-bold mb-1">@Model.User.FullName</h4>
                                <p class="text-muted mb-2">@Model.User.Email</p>
                                <div class="d-flex flex-wrap align-items-center gap-2">
                                    <span class="badge @statusBadge py-2 px-3">
                                        <i class="ti @statusIcon me-1"></i>@Model.User.Status
                                    </span>
                                    @if (Model.User.Roles?.Any() == true)
                                    {
                                        foreach (var role in Model.User.Roles)
                                        {
                                            var roleBadge = role switch
                                            {
                                                "Admin" => "bg-danger-subtle text-danger",
                                                "Photographer" => "bg-primary-subtle text-primary",
                                                "Client" => "bg-success-subtle text-success",
                                                _ => "bg-secondary-subtle text-secondary"
                                            };
                                            <span class="badge @roleBadge">@role</span>
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                            <button type="button" class="btn btn-secondary" onclick="showChangePasswordModal('@Model.User.Id')">
                                <i class="ti ti-key me-1"></i>Change Password
                            </button>
                            <button type="button" class="btn btn-primary" onclick="showEditUserModal('@Model.User.Id')">
                                <i class="ti ti-edit me-1"></i>Edit User
                            </button>
                            <a asp-action="Index" class="btn btn-light">
                                <i class="ti ti-arrow-left me-1"></i>Back to Users
                            </a>
                        </div>
                    </div>
                </div>
            </article>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-xxl-10">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-header border-light">
                            <h4 class="card-title mb-0">Contact Information</h4>
                        </div>
                        <div class="card-body">
                            <div class="d-flex align-items-center gap-2 mb-3">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded">
                                    <i class="ti ti-user fs-xl text-secondary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="text-muted small">Full Name</div>
                                    <div class="fw-semibold">@Model.User.FullName</div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2 mb-3">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded">
                                    <i class="ti ti-mail fs-xl text-secondary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="text-muted small">Email Address</div>
                                    <div class="fw-semibold">@Model.User.Email</div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2 mb-3">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded">
                                    <i class="ti ti-phone fs-xl text-secondary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="text-muted small">Phone Number</div>
                                    <div class="fw-semibold">@(Model.User.PhoneNumber ?? "Not provided")</div>
                                </div>
                            </div>

                            @if (!string.IsNullOrWhiteSpace(Model.Client?.Address))
                            {
                                <div class="d-flex align-items-center gap-2 mb-3">
                                    <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded">
                                        <i class="ti ti-map-pin fs-xl text-secondary"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="text-muted small">Address</div>
                                        <div class="fw-semibold">@Model.Client?.Address</div>
                                    </div>
                                </div>
                            }

                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded">
                                    <i class="ti ti-calendar fs-xl text-secondary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="text-muted small">Account Created</div>
                                    <div class="fw-semibold">@Model.User.CreatedDate.ToString("MMMM yyyy")</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header border-light">
                            <h4 class="card-title mb-0">
                                <i class="ti ti-info-circle me-2"></i>Account Information
                            </h4>
                        </div>
                        <div class="card-body">
                            <div class="d-flex align-items-center gap-2 mb-3">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded flex-shrink-0">
                                    <i class="ti ti-id fs-xl text-secondary"></i>
                                </div>
                                <div>
                                    <div class="text-muted small">User ID</div>
                                    <div class="fw-semibold small">#USR@(Model.User.Id.Substring(0, Math.Min(8, Model.User.Id.Length)))</div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2 mb-3">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded flex-shrink-0">
                                    <i class="ti ti-mail-check fs-xl text-secondary"></i>
                                </div>
                                <div>
                                    <div class="text-muted small">Email Confirmed</div>
                                    @if (Model.User.EmailConfirmed)
                                    {
                                        <span class="badge bg-success-subtle text-success small">
                                            <i class="ti ti-check me-1"></i>Verified
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning-subtle text-warning small">
                                            <i class="ti ti-x me-1"></i>Not Verified
                                        </span>
                                    }
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2 mb-3">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded flex-shrink-0">
                                    <i class="ti ti-calendar fs-xl text-secondary"></i>
                                </div>
                                <div>
                                    <div class="text-muted small">Account Created</div>
                                    <div class="fw-semibold small">@Model.User.CreatedDate.ToString("MMM dd, yyyy")</div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar-sm bg-light d-flex align-items-center justify-content-center rounded flex-shrink-0">
                                    <i class="ti ti-login fs-xl text-secondary"></i>
                                </div>
                                <div>
                                    <div class="text-muted small">Last Login</div>
                                    <div class="fw-semibold small">
                                        @if (Model.User.LastLogin.HasValue)
                                        {
                                            @Model.User.LastLogin.Value.ToString("MMM dd, yyyy hh:mm tt")
                                        }
                                        else
                                        {
                                            <span class="text-muted">Never</span>
                                        }
                                    </div>
                                </div>
                            </div>

                            @if (Model.User.LockoutEnd.HasValue && Model.User.LockoutEnd.Value > DateTimeOffset.UtcNow)
                            {
                                <div class="alert alert-danger d-flex align-items-center mt-3" role="alert">
                                    <i class="ti ti-lock fs-xl me-2"></i>
                                    <div>
                                        <strong>Account Locked</strong>
                                        <div class="small">Until @Model.User.LockoutEnd.Value.ToString("MMMM dd, yyyy hh:mm tt")</div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    @if (!string.IsNullOrWhiteSpace(Model.Client?.Notes))
                    {
                        <div class="card">
                            <div class="card-header border-light">
                                <h4 class="card-title mb-0">
                                    <i class="ti ti-notes me-2"></i>Notes
                                </h4>
                            </div>
                            <div class="card-body">
                                <div class="bg-light p-3 rounded">
                                    <p class="mb-0">@Model.Client?.Notes</p>
                                </div>
                            </div>
                        </div>
                    }

                    @if (Model.Client != null)
                    {
                        <div class="card">
                            <div class="card-header border-light">
                                <h5 class="card-title mb-0">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex flex-column gap-2">
                                    <a asp-controller="PhotoShoots" asp-action="Create" asp-route-clientId="@Model.Client.Id"
                                       class="btn btn-success">
                                        <i class="ti ti-camera me-1"></i> Schedule Photo Shoot
                                    </a>
                                    <a asp-controller="Contracts" asp-action="Create" asp-route-clientId="@Model.Client.Id"
                                       class="btn btn-info">
                                        <i class="ti ti-file-text me-1"></i> Create Contract
                                    </a>
                                    <a asp-controller="Invoices" asp-action="Create" asp-route-clientId="@Model.Client.Id"
                                       class="btn btn-primary">
                                        <i class="ti ti-file-invoice me-1"></i> Create Invoice
                                    </a>
                                    <a href="mailto:@Model.User.Email" class="btn btn-light">
                                        <i class="ti ti-mail me-1"></i> Send Email
                                    </a>
                                    @if (!string.IsNullOrEmpty(Model.User.PhoneNumber))
                                    {
                                        <a href="tel:@Model.User.PhoneNumber" class="btn btn-light">
                                            <i class="ti ti-phone me-1"></i> Call Client
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Main Content Area -->
                <div class="col-xl-8">
                    <div class="row g-3 mb-3">
                        <div class="@statsColClass">
                            <div class="card text-center">
                                <div class="card-body py-3">
                                    <div class="avatar avatar-lg bg-primary-subtle mb-2 mx-auto">
                                        <span class="avatar-title text-primary rounded-circle">
                                            <i class="ti ti-users fs-1"></i>
                                        </span>
                                    </div>
                                    <div class="text-muted small">Total Clients</div>
                                    <div class="h4 mt-1 mb-0">@Model.User.TotalClients</div>
                                </div>
                            </div>
                        </div>

                        <div class="@statsColClass">
                            <div class="card text-center">
                                <div class="card-body py-3">
                                    <div class="avatar avatar-lg bg-success-subtle mb-2 mx-auto">
                                        <span class="avatar-title text-success rounded-circle">
                                            <i class="ti ti-camera fs-1"></i>
                                        </span>
                                    </div>
                                    <div class="text-muted small">Photo Shoots</div>
                                    <div class="h4 mt-1 mb-0">@Model.User.TotalPhotoShoots</div>
                                </div>
                            </div>
                        </div>

                        <div class="@statsColClass">
                            <div class="card text-center">
                                <div class="card-body py-3">
                                    <div class="avatar avatar-lg bg-info-subtle mb-2 mx-auto">
                                        <span class="avatar-title text-info rounded-circle">
                                            <i class="ti ti-file-invoice fs-1"></i>
                                        </span>
                                    </div>
                                    <div class="text-muted small">Invoices</div>
                                    <div class="h4 mt-1 mb-0">@Model.User.TotalInvoices</div>
                                </div>
                            </div>
                        </div>

                        @if (Model.Client != null)
                        {
                            <div class="@statsColClass">
                                <div class="card text-center">
                                    <div class="card-body py-3">
                                        <div class="avatar avatar-lg bg-success-subtle mb-2 mx-auto">
                                            <span class="avatar-title text-success rounded-circle">
                                                <i class="ti ti-cash fs-1"></i>
                                            </span>
                                        </div>
                                        <div class="text-muted small">Total Revenue</div>
                                        <div class="h4 mt-1 mb-0 text-success">@Model.Client.TotalRevenue.ToString("C")</div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="card mb-3">
                        <div class="card-header border-light">
                            <h6 class="mb-0 fw-semibold">
                                <i class="ti ti-shield-check me-2"></i>Permissions
                            </h6>
                        </div>
                        <div class="card-body">
                            @if (Model.User.Permissions?.Any() == true)
                            {
                                <ul class="list-unstyled mb-0">
                                    @foreach (var permission in Model.User.Permissions)
                                    {
                                        <li class="d-flex align-items-center mb-2">
                                            <span class="ti ti-check fs-lg text-success me-2"></span>
                                            <div>
                                                <span class="fw-semibold">@permission.Name</span>
                                                @if (!string.IsNullOrEmpty(permission.Description))
                                                {
                                                    <div class="text-muted small">@permission.Description</div>
                                                }
                                            </div>
                                        </li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <p class="text-muted text-center mb-0 small">No permissions assigned to this user's roles</p>
                            }
                        </div>
                    </div>

                    @if (Model.Client != null)
                    {
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="ti ti-award me-2"></i>Badges Earned
                                </h5>
                            </div>
                            <div class="card-body">
                                <partial name="_ClientBadges" model="@Model.Client.ClientBadges" />
                            </div>
                        </div>

                        @if (Model.Client.PhotoShoots != null && Model.Client.PhotoShoots.Any())
                        {
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Photo Shoots</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover align-middle mb-0">
                                            <thead class="bg-light bg-opacity-25">
                                                <tr class="text-uppercase fs-xxs">
                                                    <th>Title</th>
                                                    <th>Date</th>
                                                    <th>Location</th>
                                                    <th>Status</th>
                                                    <th class="text-center">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var shoot in Model.Client.PhotoShoots.OrderByDescending(s => s.ScheduledDate))
                                                {
                                                    <tr>
                                                        <td>
                                                            <strong>@shoot.Title</strong>
                                                        </td>
                                                        <td>@shoot.ScheduledDate.ToString("MMM dd, yyyy")</td>
                                                        <td>@(shoot.Location ?? "N/A")</td>
                                                        <td>
                                                            @switch (shoot.Status)
                                                            {
                                                                case PhotoShootStatus.Scheduled:
                                                                    <span class="badge bg-info-subtle text-info">Scheduled</span>
                                                                    break;
                                                                case PhotoShootStatus.Completed:
                                                                    <span class="badge bg-success-subtle text-success">Completed</span>
                                                                    break;
                                                                case PhotoShootStatus.Cancelled:
                                                                    <span class="badge bg-danger-subtle text-danger">Cancelled</span>
                                                                    break;
                                                                case PhotoShootStatus.InProgress:
                                                                default:
                                                                    <span class="badge bg-warning-subtle text-warning">Pending</span>
                                                                    break;
                                                            }
                                                        </td>
                                                        <td class="text-center">
                                                            <a asp-controller="PhotoShoots" asp-action="Details"
                                                               asp-route-id="@shoot.Id"
                                                               class="btn btn-light btn-icon btn-sm rounded-circle">
                                                                <i class="ti ti-eye fs-lg"></i>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.Client.Invoices != null && Model.Client.Invoices.Any())
                        {
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Invoices</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover align-middle mb-0">
                                            <thead class="bg-light bg-opacity-25">
                                                <tr class="text-uppercase fs-xxs">
                                                    <th>Invoice #</th>
                                                    <th>Date</th>
                                                    <th>Due Date</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th class="text-center">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var invoice in Model.Client.Invoices.OrderByDescending(i => i.InvoiceDate))
                                                {
                                                    <tr>
                                                        <td><strong>@invoice.InvoiceNumber</strong></td>
                                                        <td>@invoice.InvoiceDate.ToString("MMM dd, yyyy")</td>
                                                        <td>@invoice.DueDate.ToString("MMM dd, yyyy")</td>
                                                        <td><strong>@((invoice.Amount + invoice.Tax).ToString("C"))</strong></td>
                                                        <td>
                                                            @switch (invoice.Status.ToString())
                                                            {
                                                                case "Paid":
                                                                    <span class="badge bg-success-subtle text-success">Paid</span>
                                                                    break;
                                                                case "Overdue":
                                                                    <span class="badge bg-danger-subtle text-danger">Overdue</span>
                                                                    break;
                                                                case "Pending":
                                                                    <span class="badge bg-warning-subtle text-warning">Pending</span>
                                                                    break;
                                                                default:
                                                                    <span class="badge bg-info-subtle text-info">@invoice.Status</span>
                                                                    break;
                                                            }
                                                        </td>
                                                        <td class="text-center">
                                                            <a asp-controller="Invoices" asp-action="Details"
                                                               asp-route-id="@invoice.Id"
                                                               class="btn btn-light btn-icon btn-sm rounded-circle">
                                                                <i class="ti ti-eye fs-lg"></i>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.Client.Contracts != null && Model.Client.Contracts.Any())
                        {
                            <div class="card mb-3">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="card-title mb-0">
                                        <i class="ti ti-file-text me-2"></i>Contracts
                                    </h5>
                                    <a asp-controller="Contracts" asp-action="Create" asp-route-clientId="@Model.Client.Id" class="btn btn-sm btn-primary">
                                        <i class="ti ti-plus me-1"></i> New Contract
                                    </a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover align-middle mb-0">
                                            <thead class="bg-light bg-opacity-25">
                                                <tr class="text-uppercase fs-xxs">
                                                    <th>Title</th>
                                                    <th>Created</th>
                                                    <th>Status</th>
                                                    <th>Signed Date</th>
                                                    <th class="text-center">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var contract in Model.Client.Contracts.OrderByDescending(c => c.CreatedDate))
                                                {
                                                    <tr>
                                                        <td>
                                                            <strong>@contract.Title</strong>
                                                            @if (contract.AwardBadgeOnSign)
                                                            {
                                                                <span class="badge bg-warning-subtle text-warning ms-2" title="Awards badge on signing">
                                                                    <i class="ti ti-award"></i>
                                                                </span>
                                                            }
                                                        </td>
                                                        <td>@contract.CreatedDate.ToString("MMM dd, yyyy")</td>
                                                        <td>
                                                            @switch (contract.Status)
                                                            {
                                                                case MyPhotoBiz.Enums.ContractStatus.Draft:
                                                                    <span class="badge bg-secondary-subtle text-secondary">Draft</span>
                                                                    break;
                                                                case MyPhotoBiz.Enums.ContractStatus.PendingSignature:
                                                                    <span class="badge bg-warning-subtle text-warning">Pending Signature</span>
                                                                    break;
                                                                case MyPhotoBiz.Enums.ContractStatus.Signed:
                                                                    <span class="badge bg-success-subtle text-success">
                                                                        <i class="ti ti-check me-1"></i>Signed
                                                                    </span>
                                                                    break;
                                                                case MyPhotoBiz.Enums.ContractStatus.Expired:
                                                                    <span class="badge bg-danger-subtle text-danger">Expired</span>
                                                                    break;
                                                                default:
                                                                    <span class="badge bg-info-subtle text-info">@contract.Status</span>
                                                                    break;
                                                            }
                                                        </td>
                                                        <td>
                                                            @if (contract.SignedDate.HasValue)
                                                            {
                                                                @contract.SignedDate.Value.ToString("MMM dd, yyyy")
                                                            }
                                                            else
                                                            {
                                                                <span class="text-muted">â€”</span>
                                                            }
                                                        </td>
                                                        <td class="text-center">
                                                            <div class="btn-group" role="group">
                                                                <a asp-controller="Contracts" asp-action="Details"
                                                                   asp-route-id="@contract.Id"
                                                                   class="btn btn-light btn-icon btn-sm"
                                                                   title="View Details">
                                                                    <i class="ti ti-eye"></i>
                                                                </a>
                                                                @if (contract.Status == MyPhotoBiz.Enums.ContractStatus.Draft)
                                                                {
                                                                    <a asp-controller="Contracts" asp-action="Edit"
                                                                       asp-route-id="@contract.Id"
                                                                       class="btn btn-light btn-icon btn-sm"
                                                                       title="Edit">
                                                                        <i class="ti ti-edit"></i>
                                                                    </a>
                                                                }
                                                                @if (!string.IsNullOrEmpty(contract.PdfFilePath))
                                                                {
                                                                    <a href="@contract.PdfFilePath" target="_blank"
                                                                       class="btn btn-light btn-icon btn-sm"
                                                                       title="View PDF">
                                                                        <i class="ti ti-file-download"></i>
                                                                    </a>
                                                                }
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="card mb-3">
                                <div class="card-body text-center py-5">
                                    <i class="ti ti-file-text fs-1 text-muted"></i>
                                    <p class="text-muted mt-3 mb-3">No contracts found for this client.</p>
                                    <a asp-controller="Contracts" asp-action="Create" asp-route-clientId="@Model.Client.Id" class="btn btn-primary">
                                        <i class="ti ti-plus me-1"></i> Create First Contract
                                    </a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="card mb-3">
                            <div class="card-body text-center py-5">
                                <i class="ti ti-user-off fs-1 text-muted"></i>
                                <p class="text-muted mt-3 mb-0">No client profile is associated with this user.</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<div id="editUserModal"></div>
<div id="changePasswordModal"></div>

@section Scripts {
    <script>
        function showEditUserModal(userId) {
            $.ajax({
                url: '/Users/Edit/' + userId,
                type: 'GET',
                success: function(result) {
                    $('#editUserModal').html(result);
                    var modal = new bootstrap.Modal(document.getElementById('editUserModalElement'));
                    modal.show();
                },
                error: function() {
                    showToast('Error', 'Failed to load edit user form', 'error');
                }
            });
        }

        function showChangePasswordModal(userId) {
            $.ajax({
                url: '/Users/ChangePassword/' + userId,
                type: 'GET',
                success: function(result) {
                    $('#changePasswordModal').html(result);
                    var modal = new bootstrap.Modal(document.getElementById('changePasswordModalElement'));
                    modal.show();
                },
                error: function() {
                    showToast('Error', 'Failed to load change password form', 'error');
                }
            });
        }

        function showToast(title, message, type) {
            if (typeof toastr !== 'undefined') {
                toastr[type](message, title);
            } else {
                alert(title + ': ' + message);
            }
        }
    </script>
}
