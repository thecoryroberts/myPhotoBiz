@model MyPhotoBiz.ViewModels.CreateGalleryViewModel

<div class="modal fade" id="createGalleryModalElement" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form asp-action="Create" method="post" id="createGalleryForm">
                @Html.AntiForgeryToken()

                <div class="modal-header">
                    <h5 class="modal-title"><i class="ti ti-photo-plus me-2"></i>Create New Gallery</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <!-- Nav Tabs -->
                    <ul class="nav nav-tabs mb-3" id="createGalleryTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="basic-info-tab" data-bs-toggle="tab" data-bs-target="#basic-info" type="button" role="tab">
                                <i class="ti ti-info-circle me-1"></i>Basic Info
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="access-settings-tab" data-bs-toggle="tab" data-bs-target="#access-settings" type="button" role="tab">
                                <i class="ti ti-key me-1"></i>Access Settings
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="photo-selection-tab" data-bs-toggle="tab" data-bs-target="#photo-selection" type="button" role="tab">
                                <i class="ti ti-photo-album me-1"></i>Select Albums
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <!-- Tab 1: Basic Info -->
                        <div class="tab-pane fade show active" id="basic-info" role="tabpanel">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="Name" class="form-label">Gallery Name <span class="text-danger">*</span></label>
                                    <input asp-for="Name" class="form-control" placeholder="Enter gallery name">
                                    <span asp-validation-for="Name" class="text-danger small"></span>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="ExpiryDate" class="form-label">Expiry Date <span class="text-danger">*</span></label>
                                    <input asp-for="ExpiryDate" type="date" class="form-control">
                                    <span asp-validation-for="ExpiryDate" class="text-danger small"></span>
                                </div>

                                <div class="col-12">
                                    <label asp-for="Description" class="form-label">Description <span class="text-danger">*</span></label>
                                    <textarea asp-for="Description" class="form-control" rows="3" placeholder="Describe this gallery..."></textarea>
                                    <span asp-validation-for="Description" class="text-danger small"></span>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="BrandColor" class="form-label">Brand Color</label>
                                    <input asp-for="BrandColor" type="color" class="form-control form-control-color" value="#2c3e50">
                                    <span asp-validation-for="BrandColor" class="text-danger small"></span>
                                    <small class="text-muted">This color will be used in the client gallery view</small>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label d-block">Gallery Status</label>
                                    <div class="form-check form-switch">
                                        <input asp-for="IsActive" class="form-check-input" type="checkbox" checked>
                                        <label asp-for="IsActive" class="form-check-label">Active</label>
                                    </div>
                                    <small class="text-muted">Inactive galleries cannot be accessed by clients</small>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Client Access -->
                        <div class="tab-pane fade" id="access-settings" role="tabpanel">
                            <div class="alert alert-info mb-3">
                                <i class="ti ti-info-circle me-2"></i>
                                <strong>Client Access:</strong>
                                Select which clients should have access to this gallery. Clients will log in with their account to view the gallery.
                            </div>

                            <div class="client-selection">
                                <label class="form-label">Grant Access To:</label>
                                @if (Model?.AvailableClients?.Any() == true)
                                {
                                    <div class="list-group" style="max-height: 300px; overflow-y: auto;">
                                        @foreach (var client in Model.AvailableClients)
                                        {
                                            <label class="list-group-item d-flex align-items-center gap-2">
                                                <input type="checkbox" name="SelectedClientProfileIds" value="@client.Id"
                                                       class="form-check-input" @(client.IsSelected ? "checked" : "")>
                                                <div>
                                                    <strong>@client.Name</strong>
                                                    @if (!string.IsNullOrEmpty(client.Email))
                                                    {
                                                        <br><small class="text-muted">@client.Email</small>
                                                    }
                                                </div>
                                            </label>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <p class="text-muted">No clients available. Create clients first to grant gallery access.</p>
                                }
                            </div>
                        </div>

                        <!-- Tab 3: Album Selection -->
                        <div class="tab-pane fade" id="photo-selection" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <input type="text" id="album-search" class="form-control" placeholder="Search albums...">
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-outline-primary w-100" onclick="selectAllAlbums()">
                                        <i class="ti ti-check-all me-1"></i> Select All
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-outline-secondary w-100" onclick="deselectAllAlbums()">
                                        <i class="ti ti-x me-1"></i> Deselect All
                                    </button>
                                </div>
                            </div>

                            <!-- Album Grid -->
                            <div class="album-grid border rounded p-3" style="max-height: 400px; overflow-y: auto; background-color: #f8f9fa;">
                                @if (Model.AvailableAlbums.Any())
                                {
                                    <div class="list-group" id="album-list-container">
                                        @foreach (var album in Model.AvailableAlbums)
                                        {
                                            <label class="list-group-item d-flex align-items-center cursor-pointer" style="cursor: pointer;">
                                                <input type="checkbox" name="SelectedAlbumIds" value="@album.Id" class="form-check-input me-3" />
                                                <div class="flex-grow-1">
                                                    <div class="fw-bold">@album.Name</div>
                                                    @if (!string.IsNullOrEmpty(album.Description))
                                                    {
                                                        <small class="text-muted d-block">@album.Description</small>
                                                    }
                                                    <small class="text-muted">
                                                        <i class="ti ti-photo me-1"></i>@album.PhotoCount photos
                                                        @if (!string.IsNullOrEmpty(album.ClientName))
                                                        {
                                                            <span class="ms-2"><i class="ti ti-user me-1"></i>@album.ClientName</span>
                                                        }
                                                    </small>
                                                </div>
                                            </label>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center text-muted py-5">
                                        <i class="ti ti-photo-off fs-1 d-block mb-2"></i>
                                        <p>No photos available. Please upload photos first.</p>
                                    </div>
                                }
                            </div>

                            <div class="mt-3">
                                <strong id="selected-count">0</strong> photos selected
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="ti ti-x me-1"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" id="createGalleryBtn">
                        <span class="btn-text">
                            <i class="ti ti-check me-1"></i> Create Gallery
                        </span>
                        <span class="btn-loading d-none">
                            <span class="spinner-border spinner-border-sm me-1" role="status"></span>
                            Creating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .photo-checkbox-label:hover .photo-overlay {
        opacity: 1 !important;
    }
    .photo-checkbox:checked + img + .photo-overlay {
        opacity: 1 !important;
        background: rgba(25, 135, 84, 0.7) !important;
    }
</style>

<script>
    function toggleManualCodes(autoGenerate) {
        const manualCodesDiv = document.getElementById('manual-codes');
        if (autoGenerate) {
            manualCodesDiv.classList.add('d-none');
        } else {
            manualCodesDiv.classList.remove('d-none');
        }
    }

    function selectAllPhotos() {
        document.querySelectorAll('.photo-checkbox').forEach(checkbox => {
            checkbox.checked = true;
        });
        updateSelectedCount();
    }

    function deselectAllPhotos() {
        document.querySelectorAll('.photo-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });
        updateSelectedCount();
    }

    function updateSelectedCount() {
        const count = document.querySelectorAll('.photo-checkbox:checked').length;
        document.getElementById('selected-count').textContent = count;
    }

    // Photo search
    document.getElementById('photo-search')?.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        document.querySelectorAll('.photo-item').forEach(item => {
            const title = item.getAttribute('data-photo-title').toLowerCase();
            if (title.includes(searchTerm)) {
                item.classList.remove('d-none');
            } else {
                item.classList.add('d-none');
            }
        });
    });

    // Update count on checkbox change
    document.querySelectorAll('.photo-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedCount);
    });

    // Initialize count
    updateSelectedCount();
</script>
