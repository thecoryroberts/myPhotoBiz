@model MyPhotoBiz.ViewModels.GalleriesIndexViewModel
@{
    ViewBag.Title = "Galleries";
    ViewBag.PageTitle = "Gallery Management";
    ViewBag.Icon = "ti-photo-album";
    ViewBag.Color = "info";
}

<partial name="Partials/_PageTitle" />

<!-- Stats Row -->
<div class="row row-cols-xxl-4 row-cols-md-2 row-cols-1">

    <!-- Total Galleries Widget -->
    <div class="col">
        <div class="card">
            <div class="card-header d-flex border-dashed justify-content-between align-items-center">
                <h5 class="card-title">Total Galleries</h5>
                <span>
                    <a asp-controller="Galleries" asp-action="Index" class="text-muted float-end mt-n1 fs-xl">
                        <i class="ti ti-external-link"></i>
                    </a>
                </span>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="avatar fs-60 avatar-img-size flex-shrink-0">
                        <span class="avatar-title text-bg-primary bg-opacity-90 rounded-circle fs-22">
                            <i class="ti ti-credit-card"></i>
                        </span>
                    </div>
                    <div class="text-end">
                        <h3 class="mb-2 fw-normal">@Model.Stats.TotalGalleries</h3>
                        <p class="mb-0 text-muted">Total Galleries</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Galleries Widget -->
    <div class="col">
        <div class="card">
            <div class="card-header d-flex border-dashed justify-content-between align-items-center">
                <h5 class="card-title">Active Galleries</h5>
                <span>
                    <a asp-controller="Galleries" asp-action="Index" class="text-muted float-end mt-n1 fs-xl">
                        <i class="ti ti-external-link"></i>
                    </a>
                </span>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="avatar fs-60 avatar-img-size flex-shrink-0">
                        <span class="avatar-title text-bg-purple rounded-circle fs-32">
                            <i class="ti ti-package"></i>
                        </span>
                    </div>
                    <div class="text-end">
                        <h3 class="mb-2 fw-normal">@Model.Stats.ActiveGalleries</h3>
                        <p class="mb-0 text-muted">Active Galleries</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Expired Galleries Widget -->
    <div class="col">
        <div class="card">
            <div class="card-header d-flex border-dashed justify-content-between align-items-center">
                <h5 class="card-title">Expired Galleries</h5>
                <span>
                    <a asp-controller="Galleries" asp-action="Index" class="text-muted float-end mt-n1 fs-xl">
                        <i class="ti ti-external-link"></i>
                    </a>
                </span>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="avatar fs-60 avatar-img-size flex-shrink-0">
                        <span class="avatar-title text-bg-primary bg-opacity-90 rounded-circle fs-22">
                            <i class="ti ti-users"></i>
                        </span>
                    </div>
                    <div class="text-end">
                        <h3 class="mb-2 fw-normal">@Model.Stats.ExpiredGalleries</h3>
                        <p class="mb-0 text-muted">Expired Galleries</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Total Sessions Widget -->
    <div class="col">
        <div class="card">
            <div class="card-header d-flex border-dashed justify-content-between align-items-center">
                <h5 class="card-title">Total Sessions</h5>
                <span>
                    <a asp-controller="Galleries" asp-action="Index" class="text-muted float-end mt-n1 fs-xl">
                        <i class="ti ti-external-link"></i>
                    </a>
                </span>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="avatar fs-60 avatar-img-size flex-shrink-0">
                        <span class="avatar-title text-bg-purple rounded-circle fs-32">
                            <i class="ti ti-chart-bar"></i>
                        </span>
                    </div>
                    <div class="text-end">
                        <h3 class="mb-2 fw-normal">@Model.Stats.TotalSessions</h3>
                        <p class="mb-0 text-muted">Total Sessions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div> <!-- end row-->

<!-- Galleries Table Card -->
<div class="card" data-table data-table-rows-per-page="10">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">All Galleries</h5>
            <button type="button" class="btn btn-primary" onclick="showCreateGalleryModal()">
                <i class="ti ti-plus me-1"></i> Create Gallery
            </button>
        </div>

        <!-- Search and Filter Row -->
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" class="form-control" data-table-search placeholder="Search galleries...">
            </div>
            <div class="col-md-3">
                <select class="form-select" data-table-filter="status">
                    <option value="">All Statuses</option>
                    <option value="Active">Active</option>
                    <option value="Expired">Expired</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" data-table-set-rows-per-page>
                    <option value="10">10 per page</option>
                    <option value="25">25 per page</option>
                    <option value="50">50 per page</option>
                    <option value="100">100 per page</option>
                </select>
            </div>
        </div>

        <!-- Galleries Table -->
        <div class="table-responsive">
            <table class="table table-custom table-centered table-select table-hover w-100 mb-0">
                <thead class="bg-light bg-opacity-25 thead-sm">
                    <tr>
                        <th data-table-sort="name">Gallery Name</th>
                        <th data-table-sort="status">Status</th>
                        <th data-table-sort="expiryDate">Expires</th>
                        <th class="text-center">Photos</th>
                        <th class="text-center">Sessions</th>
                        <th class="text-center">Proofs</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var gallery in Model.Galleries)
                    {
                        <tr data-table-row data-status="@gallery.Status" data-name="@gallery.Name"
                            data-search="@gallery.Name @gallery.Description">

                            <td>
                                <h6 class="mb-0">@gallery.Name</h6>
                                <small class="text-muted">@gallery.Description</small>
                            </td>
                            <td>
                                @if (gallery.Status == "Active")
                                {
                                    <span class="badge bg-success-subtle text-success">
                                        <i class="ti ti-circle-check"></i> Active
                                    </span>
                                }
                                else if (gallery.Status == "Expired")
                                {
                                    <span class="badge bg-warning-subtle text-warning">
                                        <i class="ti ti-clock-x"></i> Expired
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary-subtle text-secondary">
                                        <i class="ti ti-circle-x"></i> Inactive
                                    </span>
                                }
                                @if (gallery.WatermarkEnabled)
                                {
                                    <span class="badge bg-info-subtle text-info ms-1" title="Watermark enabled on downloads">
                                        <i class="ti ti-photo-shield"></i>
                                    </span>
                                }
                            </td>
                            <td>
                                <span>@gallery.ExpiryDate.ToString("MMM dd, yyyy")</span>
                                @if (gallery.IsExpired)
                                {
                                    <br />
                            
                                    <small class="text-danger">(Expired)</small>
                                }
                            </td>
                            <td class="text-center">
                                <span class="badge bg-primary-subtle text-primary">@gallery.PhotoCount</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-info-subtle text-info">@gallery.SessionCount</span>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-success-subtle text-success">@gallery.TotalProofs</span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center justify-content-center gap-1">
                                    <button type="button" class="btn btn-sm btn-outline-info btn-icon" onclick="showGalleryDetails(@gallery.Id)" title="View Details">
                                        <i class="ti ti-eye"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary btn-icon" onclick="showEditGalleryModal(@gallery.Id)" title="Edit">
                                        <i class="ti ti-edit"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary btn-icon" onclick="showManageAccessModal(@gallery.Id)" title="Manage Client Access">
                                        <i class="ti ti-users-plus"></i>
                                    </button>
                                    @if (gallery.IsActive)
                                    {
                                        <button type="button" class="btn btn-sm btn-outline-warning btn-icon" onclick="toggleStatus(@gallery.Id, false)" title="Deactivate">
                                            <i class="ti ti-eye-off"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary btn-icon" onclick="copyAccessUrl(@gallery.Id)" title="Copy Gallery URL">
                                            <i class="ti ti-link"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary btn-icon" onclick="showSessions(@gallery.Id)" title="Sessions">
                                            <i class="ti ti-users"></i>
                                        </button>
                                    }
                                    else
                                    {
                                        <button type="button" class="btn btn-sm btn-outline-success btn-icon" onclick="toggleStatus(@gallery.Id, true)" title="Activate">
                                            <i class="ti ti-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary btn-icon disabled" title="Copy Gallery URL" disabled>
                                            <i class="ti ti-link"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary btn-icon disabled" title="Sessions" disabled>
                                            <i class="ti ti-users"></i>
                                        </button>
                                    }
                                    <button type="button" class="btn btn-sm btn-outline-danger btn-icon" onclick="deleteGallery(@gallery.Id, @Html.Raw(Json.Serialize(gallery.Name)))" title="Delete">
                                        <i class="ti ti-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div data-table-pagination-info></div>
            <div data-table-pagination></div>
        </div>
    </div>
</div>

<!-- Modal Containers -->
<div id="createGalleryModal"></div>
<div id="editGalleryModal"></div>
<div id="galleryDetailsModal"></div>
<div id="gallerySessionsModal"></div>
<div id="manageAccessModal"></div>

@section Scripts {
    <script src="~/js/pages/custom-table.js"></script>
    <script src="~/js/pages/galleries.js"></script>
}